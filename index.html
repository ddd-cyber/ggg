<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ç®€å•ç½‘é¡µä»£ç†</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#f0f2f5;color:#333;margin:0;padding:20px}
    .wrap{max-width:1100px;margin:0 auto;background:#fff;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.08);overflow:hidden}
    .header{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:28px;text-align:center}
    .content{display:grid;grid-template-columns:320px 1fr;gap:0}@media(max-width:800px){.content{grid-template-columns:1fr}}
    .sidebar{padding:20px;border-right:1px solid #eee;background:#fafbfc}
    input[type=text]{width:100%;padding:12px;border:1px solid #ddd;border-radius:6px;font-size:15px}
    button{display:block;width:100%;padding:11px;margin-top:12px;border:none;border-radius:6px;background:#667eea;color:#fff;cursor:pointer;font-size:15px}
    .main{padding:20px}
    .preview{height:640px;border:1px solid #e6e6e6;border-radius:6px;background:#fff;overflow:hidden}
    iframe{width:100%;height:100%;border:0}
    .row{display:flex;gap:10px;margin-top:12px}
    .btn-green{background:#48bb78}
    .muted{color:#666;font-size:13px;margin-top:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <h1>ğŸŒ ç®€å•ç½‘é¡µä»£ç†</h1>
      <div>åœ¨ä»£ç†ä¸­æ‰“å¼€ä»»æ„ URLï¼ˆä»…ä¾›å­¦ä¹ æµ‹è¯•ï¼‰</div>
    </div>
    <div class="content">
      <div class="sidebar">
        <label>è¾“å…¥å®Œæ•´ç½‘å€ï¼ˆåŒ…å« https://ï¼‰</label>
        <input id="urlInput" type="text" placeholder="https://www.example.com" value="https://www.google.com">
        <button id="visitBtn">ğŸš€ è®¿é—®ç½‘ç«™</button>
        <div class="row">
          <button class="btn-green" id="openNew">â†—ï¸ æ–°çª—å£æ‰“å¼€</button>
        </div>
        <div class="muted">
          æ³¨æ„ï¼šæŸäº›ç½‘ç«™å¯èƒ½è¢«ç›®æ ‡ç«™æˆ–æµè§ˆå™¨ç­–ç•¥é˜»æ­¢ï¼ˆX-Frame-Options / CSP / åçˆ¬ï¼‰ã€‚å½“ iframe æ— æ³•æ˜¾ç¤ºæ—¶è¯·å°è¯•â€œæ–°çª—å£æ‰“å¼€â€ã€‚
        </div>
      </div>
      <div class="main">
        <h3>ç½‘ç«™é¢„è§ˆ</h3>
        <div class="preview" id="preview">
          <iframe id="proxyFrame" title="ä»£ç†é¢„è§ˆ"></iframe>
        </div>
        <div class="row">
          <button id="refreshBtn">ğŸ”„ åˆ·æ–°é¡µé¢</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const urlInput = document.getElementById('urlInput');
    const proxyFrame = document.getElementById('proxyFrame');
    const visitBtn = document.getElementById('visitBtn');
    const openNew = document.getElementById('openNew');
    const refreshBtn = document.getElementById('refreshBtn');

    function setFrameTarget(targetUrl) {
      const encoded = encodeURIComponent(targetUrl);
      proxyFrame.src = `/api/proxy?target=${encoded}`;
    }

    visitBtn.onclick = () => {
      let u = urlInput.value.trim();
      if (!u) return alert('è¯·è¾“å…¥ç½‘å€');
      if (!u.startsWith('http://') && !u.startsWith('https://')) u = 'https://' + u;
      try {
        new URL(u);
      } catch (e) { return alert('ç½‘å€æ ¼å¼ä¸æ­£ç¡®'); }
      setFrameTarget(u);
    };

    openNew.onclick = () => {
      if (!proxyFrame.src) { alert('è¯·å…ˆè¾“å…¥å¹¶è®¿é—®ç½‘å€'); return; }
      window.open(proxyFrame.src, '_blank');
    };

    refreshBtn.onclick = () => {
      if (proxyFrame.src) proxyFrame.src = proxyFrame.src;
    };

    urlInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') visitBtn.click(); });

    // åˆå§‹åŠ è½½
    window.addEventListener('load', () => { setFrameTarget(urlInput.value); });
  </script>
</body>
</html>
